<html>
	<head>
		<link type="text/css" rel="stylesheet" media="all" href="style.css" /> 
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" type="text/javascript"></script>
	</head>
	<body>
		<div id="board">
			<div class="row top">
				<div id="spot0" class="spot col1"></div>
				<div id="spot1" class="spot col2"></div>
				<div id="spot2" class="spot col3"></div>
			</div>
			<div class="row middle">
				<div id="spot3" class="spot col1"></div>
				<div id="spot4" class="spot col2"></div>
				<div id="spot5" class="spot col3"></div>
			</div>
			<div class="row bottom">
				<div id="spot6" class="spot col1"></div>
				<div id="spot7" class="spot col2"></div>
				<div id="spot8" class="spot col3"></div>
			</div>
		</div><!-- board -->
		
		<div id="message"></div>
		<div id="newgame">Try again?</div>
		
		<script type="text/javascript">
			var botFirst = false;
			var busy = true;
			
			function sendmsg(val)
			{
				$.getJSON('http://localhost:8000', val, handleresponse);
			}
			
			function handleresponse(data)
			{
				if (data['mymove'] != null)
				{
					botMove(data['mymove']);
				}
				
				if (data['state'] == -1)
				{
					busy = false;
				}
				else
				{
					var message = $('#message')[0];
					if (data['state'] == 1)
					{
						message.innerHTML = 'HAHAHA! I crushed you, puny human!';
					}
					else if (data['state'] == 2)
					{
						message.innerHTML = 'You.. you beat me?! Unpossible!';
					}
					if (data['state'] == 0)
					{
						message.innerHTML = 'We tied. Drat.';
					}
					$("#newgame")[0].style.display = "block";
				}
			}
			
			function reset()
			{
				$('.spot').each(function(x,spot) {
					spot.innerHTML = '';
				});
				$("#message")[0].innerHTML = '';
				$("#newgame")[0].style.display = 'none';
				
				sendmsg({'reset':botFirst});
			}
			
			function setSpot(spot, mark, color)
			{
				//var spot = $('#spot'+num)[0];
				if (spot.innerHTML != '')
				{
					return false;
				}
				spot.innerHTML = mark;
				spot.style.color = color;
				return true;
			}
			
			function humanMove(spot)
			{
				if (busy || spot.innerHTML != '')
				{
					return false;
				}
				var mark = botFirst ? "O" : "X";
				var color = botFirst ? "green" : "blue";
				setSpot(spot, mark, color);
				
				sendmsg({'human': spot.id.replace('spot','')});
			}
			
			function newGame()
			{
				$("#newgame").style.display = "none";
				botFirst = !botFirst;
				reset();
			}
			
			function botMove(num)
			{
				var spot = $('#spot' + num)[0];
				var mark = botFirst ? "X" : "O";
				var color = botFirst ? "blue" : "green";
				return setSpot(spot, mark, color);
			}
			
			$('#newgame').click(function() {
				reset();
			});
			
			$('.spot').click(function() {
				humanMove(this);
			});
			reset();

		</script>
	</body>
</html>