{% extends "base.html" %}
{% block title %}Tic-Tac-Toe Demo{% endblock %}
{% block script %}

var imgtictactoe_x = "{{MEDIA_URL}}images/x.jpg";
var imgtictactoe_o = "{{MEDIA_URL}}images/o.jpg";
var imgtictactoe_b = "{{MEDIA_URL}}images/blank.jpg";

var interCharDelay = 20;
var betweenEl      = 600;

var txtgreeting1 = "GREETINGS PROFESSOR FALKEN";
var txtgreeting2 = "SHALL WE PLAY A GAME?";


var txtoption1   = "GLOBAL THERMONUCLEAR WAR";
var alert1       = "WINNER: NONE";

var txtoption2   = "TIC-TAC-TOE";
var alert2       = "YOUR MOVE";


var txtgamenames = {
                        "gtw" :       txtoption1,
                        "tictactoe" : txtoption2
                    };


var main         = null;
var greeting     = null;
var games        = {};
var gamenames    = {};

var greeting1    = null;
var greeting2    = null;
var opt1         = null;
var opt2         = null;
var menu1        = null;
var li1          = null;
var li2          = null;
var selectone    = null;

var gamemods          = {
        "gtw" :
            {
            'initGame'    : function(){
                var _result = dojo.byId("result-gtw");
                initializeScrollingElement(_result,alert1,interCharDelay);
                gamenames['gtw'].onEnd(_result.scrollText,700);

                var _return = dojo.byId("return-gtw");
                initializeScrollingElement(_return,"RETURN",interCharDelay);
                _result.onEnd(_return.scrollText,500);

            

                dojo.connect(_return,"onclick",
                             function(){
                                    
                                    removeGame("gtw");
                                    showGreeting();
                                    greetProfessorFalken();
                                    
                                });

                
                
            },
            'resetGame':function(){
                            gamenames['gtw'].innerHTML = '';
                            dojo.byId('result-gtw').innerHTML='';
                            dojo.byId('return-gtw').innerHTML='';
                            
                }
            
            
            },
            
        
        "tictactoe" :
            {
            'initGame'     : function(){
                var _yourmove = dojo.byId("yourmove-tictactoe");
                initializeScrollingElement(_yourmove,alert2,interCharDelay);
                gamenames['tictactoe'].onEnd(_yourmove.scrollText,betweenEl);
                dojo.fadeOut({node:'board-tictactoe'}).play();
                
                _yourmove.onEnd(function(){
                      dojo.fadeIn({node:'board-tictactoe',duration:1000}).play();
                });
            },
            'resetGame'    : function(){
                dojo.fadeOut({node:'board-tictactoe'});
            }
            }
};

var wipeGreeting   = function(){
    greeting1.innerHTML = '';
    greeting2.innerHTML = '';
    opt1.innerHTML      = '';
    opt2.innerHTML      = '';
    selectone.innerHTML = '';
    try{
    menu1.removeChild(li1);
    menu1.removeChild(li2);
    }catch(e){}
}
    
var showGreeting   = function(){
    try{
        
        main.appendChild(greeting);
        dojo.fadeIn({node:"greeting"}).play();
    }catch(e){
            //window.alert(e.message);
        }
}
var removeGreeting = function(){
    
    dojo.fadeOut({node:"greeting" }).play();
    wipeGreeting();
    try{
        main.removeChild(greeting);
    }catch(e){
        window.alert("error removing greeting "+e.message);
    }
}
var showGame = function(game){
    //window.alert("showing game "+game);
    try{

        main.appendChild(games[game]);
        gamenames[game].scrollText();

        try{
            //gamemods[game].startGame();
        }catch(e){}
        
    }catch(e){
            window.alert("error showing game ["+game+"] :"+e.message);
    }
}
var removeGame = function(game,fade){
    if(fade){
        dojo.fadeOut({ node: games[game] });
        
    }
    try{
        gamemods[game].resetGame();
        main.removeChild(games[game]);
    }catch(e){
            window.alert(e.message);
        }
}
var removeBothGames = function(){
    removeGame("gtw",false);
    removeGame("tictactoe",false);
}

var greetProfessorFalken = function(){
    
    greeting1.scrollText();
   
}


var initializeScrollingElement = function(element,txt,cdelay){
    element.scrolldelay    = cdelay;
    element.inprogress     = false;
    element.currentindex   = 0;
    element.currenttext    = txt;
    element.currentchars   = txt.split('');

    element._onEnd          = null;

    element.onEnd = function(f,delay){
        element._onEnd    = f;
        element._endDelay = delay;
    }


    element.scrollText = function () {
        element.currentindex = 0;
        element.inprogress   = true;
        element.innerHTML    = '';
        element.scrollNextLetter();
 	
    }
    element.scrollNextLetter = function(){
       if (element.currentindex<element.currentchars.length) {
 		 element.scrolling = setTimeout(
                     function () {

                        letter = document.createTextNode(element.currentchars[element.currentindex]);
 	                if (letter.value == '\\'){ letter.value = ''; }
                        element.appendChild(letter);
                        clearTimeout(element.scrolling);
                        element.currentindex++;
                        element.scrollNextLetter();

                     },	element.scrolldelay);
 	} else {
 		 element.inprogress = false;
                 if(element._onEnd){
                    setTimeout( element._onEnd, element._endDelay);
                 }
 	}

    }



}


var initializeElements = function(){
    main     = dojo.byId("main");
    greeting = dojo.byId("greeting");
   

    games["gtw"]           = dojo.byId("gtw");
    games["tictactoe"]     = dojo.byId("tictactoe");

    gamenames["gtw"]       = dojo.byId("gamename-gtw");
    gamenames["tictactoe"] = dojo.byId("gamename-tictactoe");
    
    initializeScrollingElement(gamenames["gtw"],txtgamenames["gtw"],interCharDelay);
    initializeScrollingElement(gamenames["tictactoe"],txtgamenames["tictactoe"],interCharDelay);

    
    gamemods["gtw"].initGame();
    gamemods["tictactoe"].initGame();

    greeting1 = dojo.byId("greeting1");
    greeting2 = dojo.byId("greeting2");
    menu1     = dojo.byId("menu1");
    opt1      = dojo.create('a',{
                href: '#',
                onclick: function(){
                        removeGreeting();
                        showGame("gtw");
                }
            });
    opt2      = dojo.create('a',{
                href: '#',
                onclick: function(){
                       removeGreeting();
                       showGame("tictactoe");
                }
            });
    li1 = dojo.create('li',{});
    li2 = dojo.create('li',{});
    selectone = dojo.byId("selectone");
    
    initializeScrollingElement(greeting1,txtgreeting1,interCharDelay);
    initializeScrollingElement(greeting2,txtgreeting2,interCharDelay);
    initializeScrollingElement(opt1,txtoption1,interCharDelay);
    initializeScrollingElement(opt2,txtoption2,interCharDelay);
    initializeScrollingElement(selectone,"SELECT ONE",interCharDelay);

 
    greeting1.onEnd(greeting2.scrollText,betweenEl);
    greeting2.onEnd(function(){
                        
                        dojo.place(opt1,li1);
                        dojo.place(li1,menu1);
                        opt1.scrollText();
                        },betweenEl);
 
    opt1.onEnd(function(){
                        dojo.place(opt2,li2);
                        dojo.place(li2,menu1);
                        opt2.scrollText();
                        },betweenEl);   

    opt2.onEnd(selectone.scrollText,betweenEl);
                        

}







{% endblock %}
{% block styles %}
#main{
  font-family: monospace;
  font-weight: bold;
  font-size:   24pt;
  margin-top:  2em;
  margin-left: 4em;
  color:       #009;
  
}
#menu1{
  margin-left: 2em;
}
a{
    text-decoration: none;
}
a:link{
        color: #009;
}
a:visited{
        color: #009;
}
a:hover{
        color: #f00;
}
a:active{
        color: #ff0;
}
.return{
    margin-top: 2em;
}

.tictactoe-tl{
    border-bottom: 2px solid #009;
    border-right:  2px solid #009;
}
.tictactoe-tm{
    border-bottom: 2px solid #009;
    border-right:  2px solid #009;
    border-left:   2px solid #009;
}
.tictactoe-tr{
    border-bottom: 2px solid #009;
    border-left:   2px solid #009;
}
.tictactoe-ml{
    border-right:  2px solid #009;
    border-top:    2px solid #009;
    border-bottom: 2px solid #009;
}
.tictactoe-mm{
    border: 2px solid #009;
}
.tictactoe-mr{
    border-left:  2px solid #009;
    border-top:    2px solid #009;
    border-bottom: 2px solid #009;
}
.tictactoe-ll{
    border-top: 2px solid #009;
    border-right:  2px solid #009;
}
.tictactoe-lm{
    border-top: 2px solid #009;
    border-right:  2px solid #009;
    border-left:   2px solid #009;
}
.tictactoe-lr{
    border-top:   2px solid #009;
    border-left:   2px solid #009;
}
{% endblock %}
{% block ready %}
    initializeElements();
    removeBothGames();
    greetProfessorFalken();
{% endblock %}
{% block content %}
<div id="main">
<div id="greeting">
<div id="greeting1"></div>
<div id="greeting2"></div>
<ol id="menu1"></ol>
<div id="selectone"></div>
</div>
<div id="gtw">
<div id="gamename-gtw"></div>
<div id="result-gtw"></div>
<div class="return"><a id="return-gtw" href="#"></a></div>
</div>

<div id="tictactoe">
<div id="gamename-tictactoe"></div>
<div id="yourmove-tictactoe"></div>

<div id="board-tictactoe">

<table border=0 cellspacing="0">
<tr>
<td class="tictactoe-tl"><a href="javascript:yourChoice('A')"><img src="{{MEDIA_URL}}images/blank.jpg" border=0 height=100 width=100 name=A alt="Top-Left"></a></td>
<td class="tictactoe-tm"><a href="javascript:yourChoice('B')"><img src="{{MEDIA_URL}}images/blank.jpg" border=0 height=100 width=100 name=B alt="Top-Center"></a></td>
<td class="tictactoe-tr"><a href="javascript:yourChoice('C')"><img src="{{MEDIA_URL}}images/blank.jpg" border=0 height=100 width=100 name=C alt="Top-Right"></a></td>
</tr>
<tr>
<td class="tictactoe-ml"><a href="javascript:yourChoice('D')"><img src="{{MEDIA_URL}}images/blank.jpg" border=0 height=100 width=100 name=D alt="Middle-Left"></a></td>
<td class="tictactoe-mm"><a href="javascript:yourChoice('E')"><img src="{{MEDIA_URL}}images/blank.jpg" border=0 height=100 width=100 name=E alt="Middle-Center"></a></td>
<td class="tictactoe-mr"><a href="javascript:yourChoice('F')"><img src="{{MEDIA_URL}}images/blank.jpg" border=0 height=100 width=100 name=F alt="Middle-Right"></a></td>
</tr>
<tr>
<td class="tictactoe-ll"><a href="javascript:yourChoice('G')"><img src="{{MEDIA_URL}}images/blank.jpg" border=0 height=100 width=100 name=G alt="Bottom-Left"></a></td>
<td class="tictactoe-lm"><a href="javascript:yourChoice('H')"><img src="{{MEDIA_URL}}images/blank.jpg" border=0 height=100 width=100 name=H alt="Bottom-Center"></a></td>
<td class="tictactoe-lr"><a href="javascript:yourChoice('I')"><img src="{{MEDIA_URL}}images/blank.jpg" border=0 height=100 width=100  name=I alt="Bottom-Right"></a></td>
</tr>
</table>


</div>

<div id="result-tictactoe"></div>
<div class="return"><a id="return-tictactoe" href="#"></a></div>
</div>

</div>

<!--

-->
{% endblock %}
